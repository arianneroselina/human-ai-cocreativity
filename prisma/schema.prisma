datasource db {
  provider  = "postgresql"
  url       = env("PRISMA_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Workflow {
  human
  ai
  human_ai
  ai_human
}

enum Gender {
  female
  male
  prefer_not_to_say
}

enum Education {
  secondary
  bachelor
  master
  phd
  other
  prefer_not_to_say
}

enum EnglishLevel {
  a1
  a2
  b1
  b2
  c1
  c2
  native
  prefer_not_to_say
}

model Participant {
  id         String    @id @default(uuid())
  createdAt  DateTime  @default(now())
  sessions   Session[]
}

model Session {
  id               String           @id @default(cuid())
  participant      Participant      @relation(fields: [participantId], references: [id])
  participantId    String
  totalRounds      Int
  startedAt        DateTime         @default(now())
  finishedAt       DateTime?
  timeMs           Int?
  rounds           Round[]
  preQuestionnaire PreQuestionnaire?
  feedback         Feedback?
  consent          Consent?
}

model Consent {
  id        String   @id @default(cuid())
  session   Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  sessionId String   @unique
  consented Boolean
  consentedAt DateTime?
  version   String
  textHash  String
  createdAt DateTime @default(now())
}

model PreQuestionnaire {
  id                String       @id @default(cuid())
  session           Session      @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  sessionId         String       @unique
  ageGroup          String
  gender            Gender
  regionDE          String
  education         Education
  nativeLang        String
  englishLevel      EnglishLevel
  writingConfidence Int
  aiFamiliarity     Int
  aiAttitude        Int
  comment           String?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
}

model Round {
  id                 String         @id @default(cuid())
  session            Session        @relation(fields: [sessionId], references: [id])
  sessionId          String
  index              Int
  workflow           Workflow
  startedAt          DateTime       @default(now())
  submittedAt        DateTime?
  text               String?
  timeMs             Int?
  wordCount          Int?
  meetsRequiredWords Boolean?
  meetsAvoidWords    Boolean?
  feedback           RoundFeedback?

  @@unique([sessionId, index])
}

model RoundFeedback {
  id             String    @id @default(cuid())
  round          Round     @relation(fields: [sessionId, roundIndex], references: [sessionId, index], onDelete: Cascade)
  sessionId      String
  roundIndex     Int
  workflow       Workflow
  liking         Int?
  trust          Int?
  satisfaction   Int?
  mentalDemand   Int?
  physicalDemand Int?
  temporalDemand Int?
  effort         Int?
  frustration    Int?
  comment        String?
  createdAt      DateTime  @default(now())

  @@unique([sessionId, roundIndex])
}

model Feedback {
  id             String   @id @default(cuid())
  session        Session  @relation(fields: [sessionId], references: [id])
  sessionId      String   @unique
  satisfaction   Int?
  clarity        Int?
  effort         Int?
  frustration    Int?
  recommendation Int?
  workflowRating Workflow?
  comments       String?
  createdAt      DateTime @default(now())
}
