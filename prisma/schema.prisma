datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Workflow {
  human
  ai
  human_ai
  ai_human
}

model Participant {
  id         String    @id @default(uuid())
  createdAt  DateTime  @default(now())
  sessions   Session[]
}

model Session {
  id            String      @id @default(cuid())
  participant   Participant @relation(fields: [participantId], references: [id])
  participantId String
  totalTrials   Int
  startedAt     DateTime    @default(now())
  finishedAt    DateTime?
  timeMs        Int?
  trials        Trial[]
  feedback      Feedback?
}

model Trial {
  id                 String    @id @default(cuid())
  session            Session   @relation(fields: [sessionId], references: [id])
  sessionId          String
  index              Int
  workflow           Workflow
  startedAt          DateTime  @default(now())
  submittedAt        DateTime?
  text               String?
  timeMs             Int?
  wordCount          Int?
  meetsRequiredWords Boolean?
  meetsAvoidWords    Boolean?

  @@unique([sessionId, index])
}

model Feedback {
  id             String   @id @default(cuid())
  session        Session  @relation(fields: [sessionId], references: [id])
  sessionId      String   @unique
  satisfaction   Int?
  clarity        Int?
  recommendation Int?
  workflowRating Workflow?
  comments       String?
  createdAt      DateTime @default(now())
}
